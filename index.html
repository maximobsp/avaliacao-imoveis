<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Avaliação de Imóveis - Maximob</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <style>
        .bg-maximob {
            background-color: #0056b3;
        }
        .text-maximob {
            color: #0056b3;
        }
        .border-maximob {
            border-color: #0056b3;
        }
        .hover\:bg-maximob-dark:hover {
            background-color: #004494;
        }
        .form-select {
            background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 20 20' fill='none'%3e%3cpath d='M7 7l3-3 3 3m0 6l-3 3-3-3' stroke='%239fa6b2' stroke-width='1.5' stroke-linecap='round' stroke-linejoin='round'/%3e%3c/svg%3e");
            background-position: right 0.5rem center;
            background-repeat: no-repeat;
            background-size: 1.5em 1.5em;
            padding-right: 2.5rem;
            -webkit-appearance: none;
            -moz-appearance: none;
            appearance: none;
        }
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(255, 255, 255, 0.8);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }
        .spinner {
            border: 4px solid rgba(0, 0, 0, 0.1);
            width: 36px;
            height: 36px;
            border-radius: 50%;
            border-left-color: #0056b3;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="bg-gray-50 min-h-screen">
    <div id="loading" class="loading-overlay hidden">
        <div class="text-center">
            <div class="spinner mx-auto"></div>
            <p class="mt-2 text-gray-700">Processando avaliação...</p>
        </div>
    </div>

    <div class="container mx-auto px-4 py-8">
        <div class="max-w-3xl mx-auto bg-white rounded-lg shadow-lg p-6">
            <!-- Logo -->
            <div class="text-center mb-6">
                <a href="https://www.robinsonimoveis.com.br" target="_blank" rel="noopener noreferrer">
                    <img src="https://robinsonimoveis.com.br/wp-content/uploads/2023/09/logo-maximob.png" alt="Maximob Logo" class="mx-auto h-16 w-auto hover:opacity-80 transition-opacity">
                </a>
            </div>

            <h1 class="text-2xl sm:text-3xl font-bold mb-2 text-center text-gray-800">Avaliação de Imóveis</h1>
            <p class="text-center text-gray-600 mb-8">Informe os dados abaixo para receber uma estimativa de valor baseada em imóveis similares</p>

            <!-- Formulário -->
            <form id="avaliacaoForm" action="https://formsubmit.co/robinson@maximob.com.br" method="POST" class="space-y-6">
                <!-- Campos ocultos para FormSubmit.co -->
                <input type="hidden" name="_subject" value="Nova Avaliação de Imóvel - Maximob">
                <input type="hidden" name="_template" value="table">
                <input type="hidden" name="_captcha" value="false">
                <input type="hidden" name="_next" value="https://robinsonimoveis.com.br/obrigado">
                
                <!-- Dados do Solicitante -->
                <div class="bg-gray-50 p-4 rounded-lg">
                    <h2 class="text-lg font-semibold mb-4 text-gray-700">Dados do Solicitante</h2>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label for="nome" class="block text-sm font-medium text-gray-700 mb-1">Nome Completo*</label>
                            <input type="text" id="nome" name="nome" required class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                        </div>
                        <div>
                            <label for="telefone" class="block text-sm font-medium text-gray-700 mb-1">Telefone*</label>
                            <input type="tel" id="telefone" name="telefone" required class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                        </div>
                        <div class="md:col-span-2">
                            <label for="email" class="block text-sm font-medium text-gray-700 mb-1">E-mail</label>
                            <input type="email" id="email" name="email" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                        </div>
                    </div>
                </div>

                <!-- Dados do Imóvel -->
                <div class="bg-gray-50 p-4 rounded-lg">
                    <h2 class="text-lg font-semibold mb-4 text-gray-700">Dados do Imóvel</h2>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label for="tipoImovel" class="block text-sm font-medium text-gray-700 mb-1">Tipo de Imóvel*</label>
                            <select id="tipoImovel" name="tipoImovel" required class="form-select w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                                <option value="">Selecione...</option>
                                <option value="Casa">Casa</option>
                                <option value="Apartamento">Apartamento</option>
                                <option value="Terreno">Terreno</option>
                                <option value="Chácara">Chácara</option>
                                <option value="Sítio">Sítio</option>
                                <option value="Sobrado">Sobrado</option>
                                <option value="Prédio">Prédio</option>
                                <option value="Área Empreendimento">Área Empreendimento</option>
                            </select>
                        </div>
                        <div>
                            <label for="cidade" class="block text-sm font-medium text-gray-700 mb-1">Cidade*</label>
                            <select id="cidade" name="cidade" required class="form-select w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                                <option value="">Selecione...</option>
                                <option value="Itapira">Itapira</option>
                                <option value="Campinas">Campinas</option>
                                <option value="Jacutinga">Jacutinga</option>
                                <option value="Amparo">Amparo</option>
                                <option value="Mogi Mirim">Mogi Mirim</option>
                                <option value="Serra Negra">Serra Negra</option>
                            </select>
                        </div>
                        <div>
                            <label for="bairro" class="block text-sm font-medium text-gray-700 mb-1">Bairro*</label>
                            <input type="text" id="bairro" name="bairro" required class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                        </div>
                        <div>
                            <label for="endereco" class="block text-sm font-medium text-gray-700 mb-1">Endereço Completo*</label>
                            <input type="text" id="endereco" name="endereco" required class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                        </div>
                        <div>
                            <label for="areaConstruida" class="block text-sm font-medium text-gray-700 mb-1">Área Construída (m²)*</label>
                            <input type="number" id="areaConstruida" name="areaConstruida" required min="1" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                        </div>
                        <div>
                            <label for="areaTerreno" class="block text-sm font-medium text-gray-700 mb-1">Área do Terreno (m²)</label>
                            <input type="number" id="areaTerreno" name="areaTerreno" min="1" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                        </div>
                    </div>
                </div>

                <!-- Detalhes Adicionais -->
                <div class="bg-gray-50 p-4 rounded-lg">
                    <h2 class="text-lg font-semibold mb-4 text-gray-700">Detalhes Adicionais (Opcional)</h2>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <div>
                            <label for="dormitorios" class="block text-sm font-medium text-gray-700 mb-1">Dormitórios</label>
                            <input type="number" id="dormitorios" name="dormitorios" min="0" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                        </div>
                        <div>
                            <label for="banheiros" class="block text-sm font-medium text-gray-700 mb-1">Banheiros</label>
                            <input type="number" id="banheiros" name="banheiros" min="0" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                        </div>
                        <div>
                            <label for="garagemCoberta" class="block text-sm font-medium text-gray-700 mb-1">Garagem Coberta</label>
                            <input type="number" id="garagemCoberta" name="garagemCoberta" min="0" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                        </div>
                        <div>
                            <label for="garagemDescoberta" class="block text-sm font-medium text-gray-700 mb-1">Garagem Descoberta</label>
                            <input type="number" id="garagemDescoberta" name="garagemDescoberta" min="0" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                        </div>
                        <div>
                            <label for="tipoPiso" class="block text-sm font-medium text-gray-700 mb-1">Tipo de Piso</label>
                            <input type="text" id="tipoPiso" name="tipoPiso" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                        </div>
                        <div>
                            <label for="tipoConstrucao" class="block text-sm font-medium text-gray-700 mb-1">Tipo de Construção</label>
                            <input type="text" id="tipoConstrucao" name="tipoConstrucao" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                        </div>
                    </div>
                    <div class="mt-4 grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div class="flex items-center">
                            <input type="checkbox" id="areaServico" name="areaServico" class="h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded">
                            <label for="areaServico" class="ml-2 block text-sm text-gray-700">Área de Serviço</label>
                        </div>
                        <div class="flex items-center">
                            <input type="checkbox" id="quintal" name="quintal" class="h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded">
                            <label for="quintal" class="ml-2 block text-sm text-gray-700">Quintal</label>
                        </div>
                    </div>
                    <div class="mt-4">
                        <label for="observacoes" class="block text-sm font-medium text-gray-700 mb-1">Observações</label>
                        <textarea id="observacoes" name="observacoes" rows="3" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"></textarea>
                    </div>
                </div>

                <!-- Botão de Envio -->
                <div class="flex flex-col items-center">
                    <p class="text-sm text-gray-500 mb-4 text-center">Ao clicar em "Avaliar Imóvel", você concorda com nossa política de privacidade.</p>
                    <button type="submit" id="submitBtn" class="bg-maximob hover:bg-maximob-dark text-white font-bold py-3 px-6 rounded-lg transition duration-300 ease-in-out transform hover:scale-105 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-opacity-50">
                        Avaliar Imóvel
                    </button>
                </div>
            </form>

            <!-- Resultado da Avaliação (inicialmente oculto) -->
            <div id="resultado" class="mt-8 hidden">
                <h2 class="text-xl font-bold mb-4 text-center text-gray-800">Resultado da Avaliação</h2>
                <div class="bg-gray-50 p-6 rounded-lg">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div class="bg-white p-4 rounded-lg shadow">
                            <h3 class="font-semibold text-lg mb-2 text-maximob">Valor de Mercado</h3>
                            <p id="valorMercado" class="text-2xl font-bold">R$ 0,00</p>
                        </div>
                        <div class="bg-white p-4 rounded-lg shadow">
                            <h3 class="font-semibold text-lg mb-2 text-maximob">Valor Otimista</h3>
                            <p id="valorOtimista" class="text-2xl font-bold">R$ 0,00</p>
                        </div>
                        <div class="bg-white p-4 rounded-lg shadow">
                            <h3 class="font-semibold text-lg mb-2 text-maximob">Valor Competitivo</h3>
                            <p id="valorCompetitivo" class="text-2xl font-bold">R$ 0,00</p>
                        </div>
                        <div class="bg-white p-4 rounded-lg shadow">
                            <h3 class="font-semibold text-lg mb-2 text-maximob">Valor para Locação</h3>
                            <p id="valorLocacao" class="text-2xl font-bold">Entre R$ 0,00 e R$ 0,00</p>
                        </div>
                    </div>
                    <div class="mt-6 p-4 bg-blue-50 border-l-4 border-blue-500 text-blue-700">
                        <p class="text-sm">Importante: Esta ferramenta fornece apenas uma estimativa inicial baseada em dados médios do mercado. Não substitui uma avaliação profissional. Para uma análise precisa do valor do seu imóvel, entre em contato com nossos corretores para agendar uma visita técnica.</p>
                    </div>
                </div>
            </div>

            <!-- Mensagem de Erro (inicialmente oculta) -->
            <div id="erro" class="mt-8 hidden">
                <div class="bg-red-50 border-l-4 border-red-500 p-4">
                    <div class="flex">
                        <div class="flex-shrink-0">
                            <svg class="h-5 w-5 text-red-400" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">
                                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z" clip-rule="evenodd" />
                            </svg>
                        </div>
                        <div class="ml-3">
                            <p class="text-sm text-red-700" id="mensagemErro">
                                Não foi possível calcular a avaliação para este imóvel. Por favor, verifique os dados informados ou entre em contato conosco.
                            </p>
                            <p class="text-sm text-red-700 mt-2">
                                Seus dados foram enviados com sucesso para nossa equipe, que entrará em contato para uma avaliação personalizada.
                            </p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Rodapé -->
        <footer class="mt-8 text-center text-gray-500 text-sm">
            <p>&copy; 2025 Maximob Imobiliária. Todos os direitos reservados.</p>
            <p class="mt-1">
                <a href="https://www.robinsonimoveis.com.br" target="_blank" rel="noopener noreferrer" class="text-maximob hover:underline">www.robinsonimoveis.com.br</a>
            </p>
        </footer>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const form = document.getElementById('avaliacaoForm');
            const loading = document.getElementById('loading');
            const resultado = document.getElementById('resultado');
            const erro = document.getElementById('erro');
            const submitBtn = document.getElementById('submitBtn');

            // Função para formatar valores em reais
            function formatarMoeda(valor) {
                return valor.toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' });
            }

            // Função para calcular avaliação (simulação simples)
            function calcularAvaliacao(data) {
                // Esta é uma simulação simplificada baseada em valores médios
                // Em um ambiente real, você usaria dados reais do mercado
                
                let valorBase;
                
                // Valores base por tipo de imóvel em Itapira (simulação)
                const valoresBase = {
                    'Casa': 3000,
                    'Apartamento': 4000,
                    'Terreno': 600,
                    'Chácara': 1500,
                    'Sítio': 800,
                    'Sobrado': 3500,
                    'Prédio': 4500,
                    'Área Empreendimento': 1000
                };
                
                // Fatores de ajuste por cidade (simulação)
                const fatoresCidade = {
                    'Itapira': 1.0,
                    'Campinas': 2.2,
                    'Jacutinga': 0.8,
                    'Amparo': 1.3,
                    'Mogi Mirim': 1.4,
                    'Serra Negra': 1.5
                };
                
                // Obter valor base pelo tipo de imóvel
                valorBase = valoresBase[data.tipoImovel] || 2000;
                
                // Aplicar fator de ajuste pela cidade
                const fatorCidade = fatoresCidade[data.cidade] || 1.0;
                
                // Calcular valor por m²
                const valorM2 = valorBase * fatorCidade;
                
                // Calcular valor total
                const valorTotal = valorM2 * parseFloat(data.areaConstruida);
                
                // Calcular variações
                const valorOtimista = valorTotal * 1.15;
                const valorCompetitivo = valorTotal * 0.9;
                const valorLocacaoMin = valorTotal * 0.0048;
                const valorLocacaoMax = valorTotal * 0.0058;
                
                return {
                    valorMercado: valorTotal,
                    valorOtimista: valorOtimista,
                    valorCompetitivo: valorCompetitivo,
                    valorLocacaoMin: valorLocacaoMin,
                    valorLocacaoMax: valorLocacaoMax
                };
            }

            // Função para enviar dados para WhatsApp como backup
            function enviarParaWhatsApp(data) {
                // Formatar mensagem para WhatsApp
                const mensagem = `
*NOVA AVALIAÇÃO DE IMÓVEL*

*DADOS DO SOLICITANTE:*
Nome: ${data.nome}
Email: ${data.email || 'Não informado'}
Telefone: ${data.telefone}

*DADOS DO IMÓVEL:*
Tipo: ${data.tipoImovel}
Cidade: ${data.cidade}
Bairro: ${data.bairro}
Endereço: ${data.endereco}
Área Construída: ${data.areaConstruida}m²
Área do Terreno: ${data.areaTerreno || 'Não informado'}m²

*DETALHES ADICIONAIS:*
Dormitórios: ${data.dormitorios || 'Não informado'}
Banheiros: ${data.banheiros || 'Não informado'}
Garagem Coberta: ${data.garagemCoberta || 'Não informado'}
Garagem Descoberta: ${data.garagemDescoberta || 'Não informado'}
Área de Serviço: ${data.areaServico ? 'Sim' : 'Não'}
Quintal: ${data.quintal ? 'Sim' : 'Não'}
Tipo de Piso: ${data.tipoPiso || 'Não informado'}
Tipo de Construção: ${data.tipoConstrucao || 'Não informado'}
Observações: ${data.observacoes || 'Não informado'}

Data e hora: ${new Date().toLocaleString('pt-BR')}
`;

                // Codificar mensagem para URL
                const mensagemCodificada = encodeURIComponent(mensagem);
                
                // Criar link do WhatsApp
                return `https://wa.me/5519978185219?text=${mensagemCodificada}`;
            }

            // Manipulador de envio do formulário
            form.addEventListener('submit', function(e) {
                e.preventDefault();
                
                // Mostrar loading
                loading.classList.remove('hidden');
                
                // Coletar dados do formulário
                const formData = new FormData(form);
                const data = Object.fromEntries(formData.entries());
                
                // Adicionar checkboxes (que não são incluídos se não marcados)
                data.areaServico = form.querySelector('#areaServico').checked;
                data.quintal = form.querySelector('#quintal').checked;
                
                // Enviar dados para FormSubmit em segundo plano
                fetch('https://formsubmit.co/ajax/robinson@maximob.com.br', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Accept': 'application/json'
                    },
                    body: JSON.stringify({
                        ...data,
                        _subject: `Nova Avaliação de Imóvel - ${data.tipoImovel} em ${data.bairro}`,
                        _template: 'table',
                        _captcha: 'false'
                    })
                }).catch(err => {
                    console.error("Erro no envio de email:", err);
                    // Se falhar, criar link para WhatsApp como backup
                    const whatsappLink = enviarParaWhatsApp(data);
                    window.open(whatsappLink, '_blank');
                });
                
                // Método alternativo como backup
                fetch('https://formspree.io/f/xdoqvkzk', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(data)
                }).catch(err => console.error("Erro no método alternativo:", err));
                
                // Simular cálculo de avaliação (com chance de erro para testar fluxo de erro)
                setTimeout(() => {
                    try {
                        // 10% de chance de simular erro para testar o fluxo de erro
                        if (Math.random() < 0.1) {
                            throw new Error("Erro simulado na avaliação");
                        }
                        
                        // Calcular avaliação
                        const valores = calcularAvaliacao(data);
                        
                        // Preencher resultados
                        document.getElementById('valorMercado').textContent = formatarMoeda(valores.valorMercado);
                        document.getElementById('valorOtimista').textContent = formatarMoeda(valores.valorOtimista);
                        document.getElementById('valorCompetitivo').textContent = formatarMoeda(valores.valorCompetitivo);
                        document.getElementById('valorLocacao').textContent = `Entre ${formatarMoeda(valores.valorLocacaoMin)} e ${formatarMoeda(valores.valorLocacaoMax)}`;
                        
                        // Mostrar resultado
                        resultado.classList.remove('hidden');
                        erro.classList.add('hidden');
                    } catch (error) {
                        console.error("Erro na avaliação:", error);
                        
                        // Mostrar mensagem de erro
                        erro.classList.remove('hidden');
                        resultado.classList.add('hidden');
                        
                        // Criar link para WhatsApp como backup
                        const whatsappLink = enviarParaWhatsApp(data);
                        
                        // Adicionar botão para enviar por WhatsApp
                        const mensagemErro = document.getElementById('mensagemErro');
                        mensagemErro.innerHTML = `
                            Não foi possível calcular a avaliação para este imóvel. 
                            <a href="${whatsappLink}" target="_blank" class="font-medium underline">
                                Clique aqui para enviar os dados via WhatsApp
                            </a> 
                            ou aguarde nosso contato.
                        `;
                    } finally {
                        // Esconder loading
                        loading.classList.add('hidden');
                        
                        // Rolar para o resultado
                        const targetElement = resultado.classList.contains('hidden') ? erro : resultado;
                        targetElement.scrollIntoView({ behavior: 'smooth', block: 'start' });
                        
                        // Desabilitar botão para evitar múltiplos envios
                        submitBtn.disabled = true;
                        submitBtn.classList.add('opacity-50');
                        submitBtn.textContent = 'Avaliação Enviada';
                    }
                }, 1500); // Simular tempo de processamento
            });
        });
    </script>
</body>
</html>
